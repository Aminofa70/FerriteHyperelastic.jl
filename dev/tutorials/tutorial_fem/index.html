<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>tutorial fem · FerriteHyperelastic.jl</title><meta name="title" content="tutorial fem · FerriteHyperelastic.jl"/><meta property="og:title" content="tutorial fem · FerriteHyperelastic.jl"/><meta property="twitter:title" content="tutorial fem · FerriteHyperelastic.jl"/><meta name="description" content="Documentation for FerriteHyperelastic.jl."/><meta property="og:description" content="Documentation for FerriteHyperelastic.jl."/><meta property="twitter:description" content="Documentation for FerriteHyperelastic.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">FerriteHyperelastic.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../install/">Install</a></li><li><a class="tocitem" href="../../functions/">Functions</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>tutorial fem</a><ul class="internal"><li><a class="tocitem" href="#Guid-to-use-Finite-Element-(fem)"><span>Guid to use Finite Element (fem)</span></a></li></ul></li><li><a class="tocitem" href="../tutorial_curve_fitting/">tutorial curve fitting</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/plane_strain_tension/">plane strain uniaxial tension</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>tutorial fem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>tutorial fem</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Aminofa70/FerriteHyperelastic.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Aminofa70/FerriteHyperelastic.jl/blob/main/docs/src/tutorials/tutorial_fem.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Guid-to-use-Finite-Element-(fem)"><a class="docs-heading-anchor" href="#Guid-to-use-Finite-Element-(fem)">Guid to use Finite Element (fem)</a><a id="Guid-to-use-Finite-Element-(fem)-1"></a><a class="docs-heading-anchor-permalink" href="#Guid-to-use-Finite-Element-(fem)" title="Permalink"></a></h2><h3 id="Create-Input-Data-Structure"><a class="docs-heading-anchor" href="#Create-Input-Data-Structure">Create Input Data Structure</a><a id="Create-Input-Data-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Input-Data-Structure" title="Permalink"></a></h3><p>Create a dynamic structure for putting FEM parameters into it.</p><pre><code class="nohighlight hljs">input = InputStruct()</code></pre><div class="admonition is-category-tipo" id="Tipo-a255d2d59c8f73ae"><header class="admonition-header">Tipo<a class="admonition-anchor" href="#Tipo-a255d2d59c8f73ae" title="Permalink"></a></header><div class="admonition-body"><p>Define geometry, mesh, and FEM parameters for interpolation and numerical integration, and define degree-of-freedom using <a href="https://ferrite-fem.github.io/Ferrite.jl/stable/">Ferrite.jl</a>.</p><p>More details for these parts can be found in <a href="https://ferrite-fem.github.io/Ferrite.jl/stable/">Ferrite.jl</a>.</p></div></div><h3 id="Mesh-generation"><a class="docs-heading-anchor" href="#Mesh-generation">Mesh generation</a><a id="Mesh-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Mesh-generation" title="Permalink"></a></h3><p>Generate mesh </p><pre><code class="nohighlight hljs">&quot;&quot;&quot;
Lx : Lenght in x-direction
Ly : Lenght in y-direction
Ferrite.Quadrilateral: Define the type of elements.
nx : Number of element in x-dir 
ny : Number of element in y-dir
&quot;&quot;&quot;
function create_grid(Lx, Ly, nx, ny)
    corners = [
        Ferrite.Vec{2}((0.0, 0.0)), Ferrite.Vec{2}((Lx, 0.0)),
        Ferrite.Vec{2}((Lx, Ly)), Ferrite.Vec{2}((0.0, Ly))
    ]
    grid = Ferrite.generate_grid(Ferrite.Quadrilateral, (nx, ny), corners)
    addnodeset!(grid, &quot;support_1&quot;, x -&gt; x[1] ≈ 0.0)
    addfacetset!(grid, &quot;pressure&quot;, x -&gt; x[1] ≈ Lx)
    return grid
end
</code></pre><h3 id="Define-FEM-values"><a class="docs-heading-anchor" href="#Define-FEM-values">Define FEM values</a><a id="Define-FEM-values-1"></a><a class="docs-heading-anchor-permalink" href="#Define-FEM-values" title="Permalink"></a></h3><p>Define FEM values (interpolation and numerical integration)</p><pre><code class="nohighlight hljs">function create_values()
    dim, order = 2, 1
    ip = Ferrite.Lagrange{Ferrite.RefQuadrilateral,order}()^dim
    qr = Ferrite.QuadratureRule{Ferrite.RefQuadrilateral}(2)
    qr_face = Ferrite.FacetQuadratureRule{Ferrite.RefQuadrilateral}(2)
    return Ferrite.CellValues(qr, ip), Ferrite.FacetValues(qr_face, ip)
end
</code></pre><div class="admonition is-info" id="Note-862053a116b13787"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-862053a116b13787" title="Permalink"></a></header><div class="admonition-body"><p>Very important to know is that the type here should be the same as the element type.</p></div></div><h3 id="Define-DOF"><a class="docs-heading-anchor" href="#Define-DOF">Define DOF</a><a id="Define-DOF-1"></a><a class="docs-heading-anchor-permalink" href="#Define-DOF" title="Permalink"></a></h3><p>Define dof (degree of freedom)</p><pre><code class="nohighlight hljs">function create_dofhandler(grid)
    dh = Ferrite.DofHandler(grid)
    Ferrite.add!(dh, :u, Ferrite.Lagrange{Ferrite.RefQuadrilateral,1}()^2)
    Ferrite.close!(dh)
    return dh
end
</code></pre><h3 id="Dirichlet-Boundary-Condition"><a class="docs-heading-anchor" href="#Dirichlet-Boundary-Condition">Dirichlet Boundary Condition</a><a id="Dirichlet-Boundary-Condition-1"></a><a class="docs-heading-anchor-permalink" href="#Dirichlet-Boundary-Condition" title="Permalink"></a></h3><p>Define Dirichlet Boundary Condition</p><pre><code class="nohighlight hljs">function create_bc(dh)
    ch = Ferrite.ConstraintHandler(dh)
    Ferrite.add!(ch, Ferrite.Dirichlet(:u, Ferrite.getnodeset(dh.grid, &quot;support_1&quot;), (x, t) -&gt; [0.0, 0.0], [1, 2]))
    Ferrite.close!(ch)
    return ch
end
</code></pre><div class="admonition is-category-hint" id="Hint-fd61fbeabddeeea2"><header class="admonition-header">Hint<a class="admonition-anchor" href="#Hint-fd61fbeabddeeea2" title="Permalink"></a></header><div class="admonition-body"><p>Optional step: if users need to plot a force-displacement curve, getting the degree of freedom from reaction force and displacement is required. For the displacement, the Dirichlet boundary condition is used. For the force, another boundary condition is defined. If this plot is not the aim, it is not necessary to define the following code. </p></div></div><pre><code class="nohighlight hljs">function create_bc_force(dh)
    dbc = Ferrite.ConstraintHandler(dh)
    Ferrite.add!(dbc, Ferrite.Dirichlet(:u, getfacetset(grid, &quot;pressure&quot;), (x, t) -&gt; 0*x))
    Ferrite.close!(dbc)
    return dbc
end
</code></pre><div class="admonition is-category-important" id="Important-13cade772cdedf0f"><header class="admonition-header">Important<a class="admonition-anchor" href="#Important-13cade772cdedf0f" title="Permalink"></a></header><div class="admonition-body"><p>It seems that Ferrite.jl does not have a direct way for finding the degree of freedom. For this reason, the above code is defined to find the degree of freedom of the reaction force, as will be seen in the following.</p></div></div><p>To now, the required functions for FEM were defined.</p><p>These parts are from the package <a href="https://ferrite-fem.github.io/Ferrite.jl/stable/">Ferrite.jl</a>. </p><hr/><hr/><h3 id="Define-hyperelastic-strain-energy-function-(here-neo-Hookean)"><a class="docs-heading-anchor" href="#Define-hyperelastic-strain-energy-function-(here-neo-Hookean)">Define hyperelastic strain energy function (here neo-Hookean)</a><a id="Define-hyperelastic-strain-energy-function-(here-neo-Hookean)-1"></a><a class="docs-heading-anchor-permalink" href="#Define-hyperelastic-strain-energy-function-(here-neo-Hookean)" title="Permalink"></a></h3><p>The strain energy function is defined</p><pre><code class="nohighlight hljs">function Ψ(C, C10, D1)
    J = sqrt(det(C))
    I1 = tr(C)
    I1_bar = I1 * J^(-2 / 3)
    return C10 * (I1_bar - 3) + (1 / D1) * (J - 1)^2
end
</code></pre><p>Second Piola–Kirchhoff stress tensor</p><pre><code class="nohighlight hljs">function constitutive_driver(C, C10, D1)
    ∂²Ψ∂C², ∂Ψ∂C = Tensors.hessian(y -&gt; Ψ(y, C10, D1), C, :all)
    S = 2.0 * ∂Ψ∂C
    ∂S∂C = 2.0 * ∂²Ψ∂C²
    return S, ∂S∂C
end
</code></pre><p>And for calling the strain energy using C, the first invariant of the Cauchy-Green deformation tensor in the FEM solver</p><pre><code class="nohighlight hljs">function make_constitutive_driver(C10, D1)
    return C -&gt; constitutive_driver(C, C10, D1)
end
</code></pre><div class="admonition is-category-hint" id="Hint-f6586c57569ee144"><header class="admonition-header">Hint<a class="admonition-anchor" href="#Hint-f6586c57569ee144" title="Permalink"></a></header><div class="admonition-body"><p>In the following, the FEM parameters are put into the dynamic structure defined above. </p></div></div><h3 id="Problem-and-Load-Type"><a class="docs-heading-anchor" href="#Problem-and-Load-Type">Problem and Load Type</a><a id="Problem-and-Load-Type-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-and-Load-Type" title="Permalink"></a></h3><p>Problem and load type are defined</p><div class="admonition is-info" id="Problem-Types-f3ec7e11dcaadd3f"><header class="admonition-header">Problem Types<a class="admonition-anchor" href="#Problem-Types-f3ec7e11dcaadd3f" title="Permalink"></a></header><div class="admonition-body"><ul><li>:plane_strain</li><li>:plane_stress</li><li>:threeD</li></ul></div></div><div class="admonition is-info" id="Load-types-7b97cf98f0cb40a0"><header class="admonition-header">Load types<a class="admonition-anchor" href="#Load-types-7b97cf98f0cb40a0" title="Permalink"></a></header><div class="admonition-body"><ul><li>:traction</li><li>:displacement</li></ul></div></div><p>This example is <code>:plane_strain</code>  and  <code>:traction</code>.</p><pre><code class="nohighlight hljs">input.model_type = :plane_strain   
input.load_type = :traction
</code></pre><h4 id="Define-material-parameters-and-Stress"><a class="docs-heading-anchor" href="#Define-material-parameters-and-Stress">Define material parameters and Stress</a><a id="Define-material-parameters-and-Stress-1"></a><a class="docs-heading-anchor-permalink" href="#Define-material-parameters-and-Stress" title="Permalink"></a></h4><pre><code class="nohighlight hljs"># E: Young&#39;s Modulus
# ν: Poisson&#39;s ratio

input.E , input.ν = 3.35, 0.45
E = input.E
ν = input.ν

C10 = E / (4 * (1 + ν))
D1 = 6.0 * (1.0 - 2.0 * ν) / E
input.material = make_constitutive_driver(C10, D1)
</code></pre><h4 id="Generate-Geometry-and-Mesh"><a class="docs-heading-anchor" href="#Generate-Geometry-and-Mesh">Generate Geometry and Mesh</a><a id="Generate-Geometry-and-Mesh-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-Geometry-and-Mesh" title="Permalink"></a></h4><p>Call the mehs function and put into in the dynamic structure.</p><pre><code class="nohighlight hljs"># Define parameters for the plate and mesh
Lx, Ly = 3.17, 1.73  # Plate dimensions
nx, ny = 10, 10   # Number of elements along x and y
grid = create_grid(Lx, Ly, nx, ny)  # Generate the grid
</code></pre><h4 id="FEM-Values,-DOF,-Dirichlet-BC"><a class="docs-heading-anchor" href="#FEM-Values,-DOF,-Dirichlet-BC">FEM Values, DOF, Dirichlet BC</a><a id="FEM-Values,-DOF,-Dirichlet-BC-1"></a><a class="docs-heading-anchor-permalink" href="#FEM-Values,-DOF,-Dirichlet-BC" title="Permalink"></a></h4><p>Get FEM values, DOF, Dirichlet BC and put them into the dynamic structure.</p><pre><code class="nohighlight hljs">input.grid = grid
input.dh = create_dofhandler(grid)
input.ch = create_bc(input.dh )
# Create CellValues and FacetValues
input.cell_values, input.facet_values = create_values()
</code></pre><h4 id="Traction-Force"><a class="docs-heading-anchor" href="#Traction-Force">Traction Force</a><a id="Traction-Force-1"></a><a class="docs-heading-anchor-permalink" href="#Traction-Force" title="Permalink"></a></h4><pre><code class="nohighlight hljs">input.ΓN = getfacetset(grid, &quot;pressure&quot;)
input.facetsets = [input.ΓN]
input.traction = [2.2, 0.0]
input.tractions = Dict(1 =&gt; input.traction)
</code></pre><h4 id="Dofs-Reaction-Force-and-Displacement"><a class="docs-heading-anchor" href="#Dofs-Reaction-Force-and-Displacement">Dofs Reaction Force &amp; Displacement</a><a id="Dofs-Reaction-Force-and-Displacement-1"></a><a class="docs-heading-anchor-permalink" href="#Dofs-Reaction-Force-and-Displacement" title="Permalink"></a></h4><p>To plot force-displacement, Dofs Reaction Force &amp; Displacement are put in the dynamic structure</p><pre><code class="nohighlight hljs">dof_F_x = input.ch.prescribed_dofs[1:2:end]
input.dof_F = dof_F_x;


dbc= create_bc_force(input.dh)
dof_U_x = dbc.prescribed_dofs[1:2:end] 
input.dof_U = dof_U_x
</code></pre><div class="admonition is-info" id="Note-b7bc24762c096ccf"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-b7bc24762c096ccf" title="Permalink"></a></header><div class="admonition-body"><p>If the force-displacement plot is not required, then</p><pre><code class="nohighlight hljs">input.dof_F = []
input.dof_U = []</code></pre></div></div><h4 id="Solver-Parameters"><a class="docs-heading-anchor" href="#Solver-Parameters">Solver Parameters</a><a id="Solver-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Solver-Parameters" title="Permalink"></a></h4><p>The settings for the solver is defined as</p><pre><code class="nohighlight hljs">input.tol = 1e-6
maxIterPerInc,totalTime,initInc,minInc,maxInc,totalInc = initialize_solver(500,1.0,1e-3,1e-15,0.8,1000)

input.maxIterPerInc = maxIterPerInc
input.totalTime = totalTime
input.initInc = initInc
input.minInc = minInc
input.maxInc = maxInc
input.totalInc = totalInc
</code></pre><div class="admonition is-category-hint" id="Hint-e539a6aa065311db"><header class="admonition-header">Hint<a class="admonition-anchor" href="#Hint-e539a6aa065311db" title="Permalink"></a></header><div class="admonition-body"><p>The default value of the solver can also be used as</p><pre><code class="nohighlight hljs">maxIterPerInc,totalTime,initInc,minInc,maxInc,totalInc = initialize_solver()</code></pre></div></div><h4 id="Save-VTU-file"><a class="docs-heading-anchor" href="#Save-VTU-file">Save VTU file</a><a id="Save-VTU-file-1"></a><a class="docs-heading-anchor-permalink" href="#Save-VTU-file" title="Permalink"></a></h4><p>The displacement of the last step is saved in the VTU file. Define a name and directory for the file. However, the built-in plot can also be implemented. </p><pre><code class="nohighlight hljs">input.filename = &quot;2D_Hyper&quot;
input.output_dir= &quot;/Users/aminalibakhshi/Desktop/vtu_geo/&quot;</code></pre><h4 id="Run-FEM-solver"><a class="docs-heading-anchor" href="#Run-FEM-solver">Run FEM solver</a><a id="Run-FEM-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Run-FEM-solver" title="Permalink"></a></h4><pre><code class="nohighlight hljs">sol  = run_fem(input)</code></pre><div class="admonition is-info" id="Note-273a08a36db23d2d"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-273a08a36db23d2d" title="Permalink"></a></header><div class="admonition-body"><p>The solver returns a structure with the following fields:</p><pre><code class="nohighlight hljs"># fieldnames(typeof(sol)) -&gt;(:U_steps, :U_effect, :F_effect) 
</code></pre></div></div><h4 id="Find-MAX-Displacement"><a class="docs-heading-anchor" href="#Find-MAX-Displacement">Find MAX Displacement</a><a id="Find-MAX-Displacement-1"></a><a class="docs-heading-anchor-permalink" href="#Find-MAX-Displacement" title="Permalink"></a></h4><pre><code class="nohighlight hljs">U = sol.U_steps[end]

# Extract final displacement and evaluate at grid nodes
U = sol.U_steps[end]
u_nodes = vec(evaluate_at_grid_nodes(input.dh, U, :u))
ux, uy = getindex.(u_nodes, 1), getindex.(u_nodes, 2)
@info &quot;Max |ux| = $(maximum(abs, ux)), Max |uy| = $(maximum(abs, uy))&quot;
</code></pre><p> </p><h4 id="Plot-Displacement-Force"><a class="docs-heading-anchor" href="#Plot-Displacement-Force">Plot Displacement Force</a><a id="Plot-Displacement-Force-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-Displacement-Force" title="Permalink"></a></h4><pre><code class="nohighlight hljs">GLMakie.closeall()
fig = Figure(size=(800, 600), fontsize=26)
ax = Axis(fig[1, 1], xlabel=&quot;Displacement&quot;, ylabel=&quot;Force&quot;, title=&quot;force-displacement&quot;, xgridvisible = false, ygridvisible = false)
lines!((sol.U_effect), abs.(sol.F_effect), color = :black)
scatter!((sol.U_effect), abs.(sol.F_effect), marker = :circle , color = :red)
display(fig)
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../functions/">« Functions</a><a class="docs-footer-nextpage" href="../tutorial_curve_fitting/">tutorial curve fitting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Sunday 12 October 2025 18:07">Sunday 12 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
